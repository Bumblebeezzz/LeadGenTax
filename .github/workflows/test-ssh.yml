name: Test SSH Connection

on:
  workflow_dispatch:  # D√©clenchement manuel uniquement

jobs:
  test-ssh:
    runs-on: ubuntu-latest
    
    steps:
      - name: Setup SSH
        run: |
          mkdir -p ~/.ssh
          chmod 700 ~/.ssh
          echo "${{ secrets.HOSTINGER_SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -H ${{ secrets.HOSTINGER_VPS_IP }} >> ~/.ssh/known_hosts 2>&1
          echo "‚úÖ Cl√© SSH configur√©e"
          echo "üîç Test de connexion..."
      
      - name: Test SSH Connection
        run: |
          ssh -i ~/.ssh/id_rsa -o StrictHostKeyChecking=no -o ConnectTimeout=10 -v root@${{ secrets.HOSTINGER_VPS_IP }} << 'EOF'
            echo "‚úÖ Connexion SSH r√©ussie"
            echo "üìç R√©pertoire: $(pwd)"
            echo "üë§ Utilisateur: $(whoami)"
            echo "üîç Test acc√®s /var/www/leadgentax.au:"
            ls -la /var/www/leadgentax.au/ 2>&1 | head -10 || echo "R√©pertoire n'existe pas ou pas accessible"
            echo "üîç Test Git:"
            cd /var/www/leadgentax.au 2>/dev/null && git status 2>&1 || echo "Pas de repository Git"
          EOF
      
      - name: Cleanup
        if: always()
        run: |
          rm -f ~/.ssh/id_rsa

